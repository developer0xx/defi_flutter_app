# Sapiency App

## Environment
Flutter 2.0.5, channel stable

## Externals
- Localizations: https://docs.google.com/spreadsheets/d/1h6J8VZNuA1tk_ifEFZzUvZEra2Ga3kZ-07oZRa51AHM/edit?usp=sharing

## Architecture overview
- State management/presentation logic: hooks + providers
- Data classes: `freezed` codegen library
- Service layer/business logic: `*Service` classes + DI
- API communication: #TODO#

## Development

### Setup
Android Studio/Intellij IDEA required. 
Make sure to upgrade flutter SDK to version specified in [Environment](#environment) section.

### Code generation
To kick off automatic code generation run `flutter pub run build_runner watch` in project dir. Generated files should never be committed to VCS.

### Localization
Project is localized based on a Google spreadsheet (link in [Externals](#externals) section). Changes in the spreadsheet will be reflected in generated `localizations.g.dart` file. Since `build_runner` has no way 
to detect changes in the spreadsheet, bump `version` parameter in `localications.dart` file to regenerate.
Localization keys should be grouped into hierarchies, e.g `auth.verify.phone.title`. Specifically, all keys related to the same screen should have common prefix. Common localizations (cancel, submit, next) should be prefixed with `common.`.

### Nullability
Insert type nullability where possible. Avoid null assertions.

### Data classes
All "data container" classes in project should be immutable and code generated by [`freezed`](https://pub.dev/packages/freezed) library. To easily create such classes copy the content of `misc/idea/fref.xml` to clipboard, open `Settings->Editor->Live Templates` in IDE, click `Dart` section and paste it. It should create a `fref` live template. Repeat for `misc/idea/fresf.xml`.
Each class should be in separate file. To create a new class, create a new .dart file, name it using `underscore_case` and type `fref` abbreviation in it. Class body will be generated. Enter properties as named parameters in the constructor and hit `ctrl+s` to generate `.freezed.dart` file.
Use `fresf` abbreviation analogously to create a serializable data class.
Use sealed classes feature where appropriate.

### Screen architecture
All screens should have following directory structure:
```
screen
|- sth  
   |- sth_screen.dart (root widget of screen)
   |- sth_screen_args.dart (optional)
   |- sth_screen_config.dart (optional)
   |- state
   |  |- sth_screen_state.dart (data class with all of screen's state)
   |  |- use_sth_screen_state.dart (optional; if logic is really simple you can include it in *_screen.dart)
   |- view
      |- sth_screen_view.dart (stateless view implementation, takes state as argument)
      
```

This file structure can be generated using `flutter_screen` code template. To install it, find your configuration
directory (for Android Studio: [docs](https://developer.android.com/studio/intro/studio-config?authuser=1), for InteliJ
IDEA: [docs](https://intellij-support.jetbrains.com/hc/en-us/articles/206544519)) and copy contents
of `misc/flutter_screen` directory to its `fileTemplates` subdirectory. After you restart your IDE,
click `New->flutter screen` on enclosing directory, enter `your_screen_name` and hit Enter to generate the boilerplate.

Screens should be grouped by usecase in `screen` directory (`auth`, `setup`). More complex flows should be enclosed
in `*Flow` class, using `NestedNavigator` (see #TODO insert any flow#).
